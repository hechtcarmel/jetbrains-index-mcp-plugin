<!-- Plugin Configuration File. Read more: https://plugins.jetbrains.com/docs/intellij/plugin-configuration-file.html -->
<idea-plugin>
    <id>com.github.hechtcarmel.jetbrainsindexmcpplugin</id>
    <name>IDE Index MCP Server</name>
    <vendor email="hechtcarmel@gmail.com" url="https://github.com/hechtcarmel">hechtcarmel</vendor>
    <description><![CDATA[
<p><b>Supercharge your AI coding assistant</b> with the IDE's powerful code intelligence through the
<a href="https://modelcontextprotocol.io">Model Context Protocol (MCP)</a>.</p>

<h3>Multi-Language Support</h3>
<p>Advanced code intelligence tools work across multiple languages when their plugins are available:</p>
<ul>
    <li><b>Java & Kotlin</b> - IntelliJ IDEA, Android Studio</li>
    <li><b>Python</b> - PyCharm (all editions), IntelliJ IDEA with Python plugin</li>
    <li><b>JavaScript & TypeScript</b> - WebStorm, IntelliJ IDEA Ultimate, PhpStorm</li>
    <li><b>Go</b> - GoLand, IntelliJ IDEA Ultimate with Go plugin</li>
    <li><b>PHP</b> - PhpStorm, IntelliJ IDEA Ultimate with PHP plugin</li>
    <li><b>Rust</b> - RustRover, IntelliJ IDEA Ultimate with Rust plugin, CLion</li>
</ul>

<h3>Universal Tools (All Supported IDEs)</h3>
<p>These tools work in every supported JetBrains IDE:</p>
<ul>
    <li><b>Find References</b> - Locate all usages of any symbol across your project</li>
    <li><b>Go to Definition</b> - Jump to symbol declarations instantly</li>
    <li><b>Code Diagnostics</b> - Access errors, warnings, and available quick fixes</li>
    <li><b>Index Status</b> - Check if the IDE is ready for code intelligence</li>
</ul>

<h3>Extended Tools (Language-Aware)</h3>
<p>These tools activate based on available language plugins:</p>
<ul>
    <li><b>Type Hierarchy</b> - Explore class inheritance chains (Java, Kotlin, Python, JavaScript, TypeScript, Go, PHP, Rust)</li>
    <li><b>Call Hierarchy</b> - Trace method/function call relationships (Java, Kotlin, Python, JavaScript, TypeScript, Go, PHP, Rust)</li>
    <li><b>Find Implementations</b> - Discover all implementations of interfaces and abstract methods</li>
    <li><b>Symbol Search</b> - Find classes, methods, functions, and fields by name with fuzzy/camelCase matching</li>
    <li><b>Find Super Methods</b> - Navigate through method override hierarchies</li>
</ul>

<h3>Refactoring Tools (Java/Kotlin)</h3>
<ul>
    <li><b>Rename Refactoring</b> - Safe symbol renaming with automatic reference updates</li>
    <li><b>Safe Delete</b> - Remove code safely with usage checking</li>
</ul>

<h3>Why This Plugin?</h3>
<ul>
    <li><b>True semantic understanding</b> - Uses the IDE's AST and index, not text matching</li>
    <li><b>Cross-project awareness</b> - Works across modules, files, and library dependencies</li>
    <li><b>Multi-language</b> - Automatically detects and uses language-specific handlers</li>
    <li><b>Safe refactoring</b> - All changes support undo (Ctrl/Cmd+Z)</li>
    <li><b>Zero external calls</b> - Everything runs locally in your IDE</li>
</ul>

<h3>Supported AI Assistants</h3>
<ul>
    <li>Claude Code (CLI)</li>
    <li>Claude Desktop</li>
    <li>Cursor</li>
    <li>Windsurf</li>
    <li>VS Code with MCP extension</li>
    <li>Any MCP-compatible client</li>
</ul>

<h3>Quick Start</h3>
<ol>
    <li>Install plugin and restart IDE</li>
    <li>Open <b>Index MCP Server</b> tool window (bottom panel)</li>
    <li>Click <b>"Install on Coding Agents"</b></li>
    <li>Select your AI assistant and follow the instructions</li>
</ol>

<p>See the <a href="https://github.com/hechtcarmel/jetbrains-index-mcp-plugin">GitHub repository</a>
for detailed documentation and examples.</p>
]]>    </description>

    <!-- Rider exclusion - plugin uses IntelliJ PSI APIs not compatible with Rider's ReSharper backend -->
    <incompatible-with>com.intellij.modules.rider</incompatible-with>

    <!-- Platform dependency (required) -->
    <depends>com.intellij.modules.platform</depends>

    <!-- Optional Java support -->
    <depends optional="true" config-file="java-features.xml">com.intellij.modules.java</depends>

    <!-- Optional Kotlin support -->
    <depends optional="true" config-file="kotlin-features.xml">org.jetbrains.kotlin</depends>

    <!-- Optional Python support (PyCharm, IntelliJ Ultimate with Python plugin) -->
    <depends optional="true" config-file="python-features.xml">com.intellij.modules.python</depends>

    <!-- Optional JavaScript support (WebStorm, IntelliJ Ultimate with JS plugin) -->
    <depends optional="true" config-file="javascript-features.xml">JavaScript</depends>

    <!-- Optional Go support (GoLand, IntelliJ Ultimate with Go plugin) -->
    <depends optional="true" config-file="go-features.xml">org.jetbrains.plugins.go</depends>

    <!-- Optional PHP support (PhpStorm, IntelliJ Ultimate with PHP plugin) -->
    <depends optional="true" config-file="php-features.xml">com.jetbrains.php</depends>

    <!-- Optional Rust support (RustRover, IntelliJ Ultimate with Rust plugin, CLion) -->
    <!-- Supports RustRover bundled plugin, official JetBrains plugin, and deprecated community plugin -->
    <depends optional="true" config-file="rust-features.xml">com.jetbrains.rust</depends>
    <depends optional="true" config-file="rust-features-alt.xml">org.jetbrains.rust</depends>
    <depends optional="true" config-file="rust-features-legacy.xml">org.rust.lang</depends>

    <resource-bundle>messages.McpBundle</resource-bundle>

    <!-- Declare Kotlin K1/K2 plugin mode compatibility -->
    <extensions defaultExtensionNs="org.jetbrains.kotlin">
        <supportsKotlinPluginMode supportsK2="true"/>
    </extensions>

    <extensions defaultExtensionNs="com.intellij">
        <!-- Application-level MCP Server Service -->
        <applicationService serviceImplementation="com.github.hechtcarmel.jetbrainsindexmcpplugin.server.McpServerService"/>

        <!-- Project-level Command History Service -->
        <projectService serviceImplementation="com.github.hechtcarmel.jetbrainsindexmcpplugin.history.CommandHistoryService"/>

        <!-- HTTP Request Handler for /index-mcp endpoint -->
        <httpRequestHandler implementation="com.github.hechtcarmel.jetbrainsindexmcpplugin.server.McpRequestHandler"/>

        <!-- Tool Window -->
        <toolWindow id="Index MCP Server" anchor="bottom" icon="com.github.hechtcarmel.jetbrainsindexmcpplugin.icons.McpIcons.ToolWindow" factoryClass="com.github.hechtcarmel.jetbrainsindexmcpplugin.ui.McpToolWindowFactory"/>

        <!-- Settings -->
        <applicationService serviceImplementation="com.github.hechtcarmel.jetbrainsindexmcpplugin.settings.McpSettings"/>
        <applicationConfigurable id="mcp.settings" displayName="Index MCP Server" instance="com.github.hechtcarmel.jetbrainsindexmcpplugin.settings.McpSettingsConfigurable"/>

        <!-- Startup Activity -->
        <postStartupActivity implementation="com.github.hechtcarmel.jetbrainsindexmcpplugin.startup.McpServerStartupActivity"/>

        <!-- Notification Group -->
        <notificationGroup id="Index MCP Server" displayType="BALLOON"/>
    </extensions>

    <!-- Extension Point for Custom Tools -->
    <extensionPoints>
        <extensionPoint name="mcpTool" interface="com.github.hechtcarmel.jetbrainsindexmcpplugin.tools.McpTool" dynamic="true"/>
    </extensionPoints>

    <actions>
        <group id="McpServer.Actions" text="Index MCP Server">
            <action id="McpServer.CopyUrl" class="com.github.hechtcarmel.jetbrainsindexmcpplugin.actions.CopyServerUrlAction" text="Copy Server URL" description="Copy the MCP server URL to clipboard"/>
            <action id="McpServer.CopyConfig" class="com.github.hechtcarmel.jetbrainsindexmcpplugin.actions.CopyClientConfigAction" text="Copy Client Config..." description="Copy MCP client configuration for AI assistants"/>
            <action id="McpServer.ClearHistory" class="com.github.hechtcarmel.jetbrainsindexmcpplugin.actions.ClearHistoryAction" text="Clear History" description="Clear command history"/>
            <action id="McpServer.ExportHistory" class="com.github.hechtcarmel.jetbrainsindexmcpplugin.actions.ExportHistoryAction" text="Export History..." description="Export command history to file"/>
        </group>
    </actions>
</idea-plugin>
